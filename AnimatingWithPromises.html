<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Animating with Promises</title>
  <style>
    #logo {
      width: 500px;
      height: 500px;
      margin: 0 auto;
    }
  </style>
  <style>
    svg * {
     transition: 1s all;
    }

    .hidden {
     opacity: 0;
    }
    .visible {
     opacity: 1 !important;
    }
    .slideup {
     transform:translateY(-35px)
    }
    .slidein {
     transform:translateX(0) !important;
    }
    #jo-js, #jo-ox {
     transform-origin: bottom right
    }
    #jo-ox.classic {
     transform: translateY(-10px) rotate(-90deg)
    }
    #jo-js.classic {
     transform: translate(30px, -20px)
    }
    .outline {
     stroke: #fff;
    }
    #jo-standard-horse {
     transform: translateX(-300px);
    }
    .spinclockwise {
     transform: rotate(-180deg);
    }
    .spinanticlockwise {
     transform: rotate(180deg);
    }
    .jo-wbars {
      transform-origin: bottom left;
    }
    .jo-cbars {
      opacity: 0;
    }
  </style>
</head>
<body>

  <div id="logo">
    <h3 id="timer">0 seconds</h3>
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 300 300">
      <path id="bg" fill="#f3df49" d="M0 0h300v300H0z"/>

      <g id="horse">
        <path class="spinclockwise jo-wbars" fill="#fff" d="M1.7 209.143L193.447-.4h107.965l.288 37.393-300 212.655" opacity=".8"/>
        <path fill="#ff00d7" d="M83.754 59.058l217.658 65.794v53.663" class="jo-cbars"/>
        <path fill="#ff0043" d="M83.754 59.058l217.658 119.6v38.25" class="jo-cbars"/>
        <path id="jo-standard-horse" d="M51.68 94.567c.663 3.568-.575 6.622-1.18 9.762-.144.68-.144 1.39-.316 2.11-.115.48-.26 1-.576 1.37-.95 1.14-1.008 2.25.173 3.22.55.45 1.3.63 1.96.91.26-.69.69-1.34.75-2.06.46-5.48 1.44-10.82 4.72-15.44.49-.69 1.39-1.06 2.02-1.63 2.33-2.2 4.67-4.37 6.91-6.65.64-.66 1.13-1.54 1.44-2.4.75-2.14 1.38-4.34 1.99-6.54.15-.55.26-1.14.18-1.69-.31-2.2.29-4.11 1.47-5.99 1.27-2 2.34-4.11 3.46-6.14 2.62.54 4.15 2.42 5.96 3.82 1.15.88 2.1 1.88 2.42 3.39.23 1.02 1.18 1.31 2.1 1.37 1.44.08 2.97-1.12 3.34-2.49.46-1.66.43-3.08-.4-4.83-1.21-2.6-2.21-5.51-2.27-8.31-.03-2.228-1.06-3.798-1.58-5.19 1.13-1.97 2.08-3.65 3.05-5.34-.14-.115-.28-.258-.43-.37-1.55 1.14-3.14 2.282-4.69 3.423-.11-.114-.2-.228-.31-.34.98-.885 1.96-1.77 2.94-2.626-.05-.11-.11-.2-.2-.31-.37.11-.78.2-1.12.37-6.79 2.94-13.84 5.25-20.15 9.16-1.26.8-2.27 1.993-3.42 2.992-1.87 1.6-3.4 3.68-5.88 4.45-.95.28-2.04.37-2.99.17-1.67-.34-3.34-.86-4.95-1.488-1.614-.625-3.08-1.74-4.724-2.22-1.96-.57-4.2-1.34-6.07-.94-4.61.97-9.24 1.37-13.88 1.8-1.327.11-2.74-.63-4.09-1-.577-.17-1.124-.46-1.73-.716-.46 4 3.4 6.797 9.647 5.2-1.267 3.026-1.295 6.22-1.24 9.42.03 2.026-1.15 3.08-2.88 3.54-1.38.37-1.64 1.14-1.64 2.454.06 3.85.03 7.704-.14 11.53-.03 1-.43 2.14-1.01 2.97-.89 1.225.408 3.423 1.64 3.34.43-.03 1.15-.717 1.21-1.17.38-2.37.66-4.77.81-7.196.117-1.855 0-3.71.03-5.566.03-1.8.375-2 2.1-2.06 1.27-.056 2.536-.484 3.774-.855.95-.284 1.38-.112 1.87.83 1.555 3.14 3.196 6.28 4.95 9.305 1.01 1.71 1.616 3.42 1.328 5.39-.17 1.17.46 1.83 1.44 2.14.548.18 1.297.18 1.758-.08.26-.14.23-1.03.15-1.54-.72-4.423-3.02-8.28-4.84-12.272-.347-.74-.663-1.452-1.067-2.394 2.82-.4 5.5-1.88 8.03.488.117.09.26.145.376.23 2.91 2.51 6.42 3.11 10.135 3.28 1.585.06 1.87.49 1.64 2.06 0 .06 0 .085-.03.14-.69 3.97-1.752 4.91-5.93 5.166-.285.022-.69-.15-.832-.377-.69-.92-1.47-1.26-2.53-.63-.95.57-1.588 1.31-1.56 2.57 2.94.823 5.904 1.623 8.956.43z"/>
        <path class="spinanticlockwise jo-wbars" fill="#fff" d="M301.7 65.252L1.7 257.925v21.98l300-151.57" opacity=".9"/>
        <path fill="#44da3c" d="M81.738 58.287l123.8 241.313h-94.72" class="jo-cbars"/>
        <path fill="#118ef4" d="M81.738 58.287L301.7 275.707V299.6h-30.518" class="jo-cbars"/>
        <path fill="#24d6ff" d="M81.738 58.287L271.182 299.6H205.54" class="jo-cbars"/>
      </g>
      <image id="members" class="hidden" width="135%" height="135%" x="-15%" y="-15%" xlink:href="http://jsoxford.com/img/memberssprites.png"/>

      <g id="jo-js">
       <path fill="#fff" d="M248.84 169.78c-4.894-9.62-13.33-16.726-23.493-19.58-9.07-2.57-18.282-2.655-27.438-.343-7.43 1.884-13.85 5.538-18.86 11.39-6.11 7.164-8.35 15.556-7.92 24.775.4 8.592 2.99 16.328 8.84 22.807 4.4 4.91 9.78 8.56 15.69 11.38 6.56 3.11 13.33 5.82 19.89 8.96 3.42 1.62 6.85 3.51 9.82 5.82 4.55 3.54 5.55 10.02 2.73 14.84-1.9 3.25-4.9 5.19-8.44 6.25-9.76 2.88-22 1.05-30.06-8.71-1.64-1.97-3.11-4.08-4.72-6.22-7.26 4.16-14.54 8.36-21.77 12.5.03.28 0 .37.03.46.11.25.23.51.37.77 4.29 7.9 10.19 14.35 18.11 18.66 16.38 8.96 33.6 9.9 51.13 4.05 9.85-3.29 17.19-9.65 21.25-19.38 2.59-6.26 3.08-12.82 2.42-19.47-.75-7.65-3.43-14.47-8.73-20.21-4.93-5.37-10.97-9.19-17.48-12.3-6.57-3.14-13.27-5.91-19.9-8.91-3.37-1.52-6.62-3.2-9.33-5.83-4.9-4.74-5.04-16.16 4.75-19.04 6.76-1.97 12.95-.6 17.82 4.8 1.58 1.74 2.88 3.76 4.4 5.79 6.88-4.4 13.82-8.82 20.84-13.3zM68.063 256.556c.086.314.115.514.2.685 4.377 8.88 10.77 15.87 20.01 19.84 12.064 5.23 24.502 5.4 36.94 1.46 9.846-3.14 16.612-9.73 20.383-19.32 2.448-6.22 3.08-12.7 3.08-19.29 0-29.54 0-59.06.03-88.6 0-1.28-.403-1.6-1.64-1.57-7.832.06-15.635.03-23.466.03-2.073 0-2.073 0-2.073 2.12 0 29.57 0 59.17-.03 88.75 0 1.86-.114 3.71-.402 5.54-.575 3.77-1.986 7.17-5.527 9.22-3.858 2.26-13.13 3.11-17.966-1.71-2.274-2.25-4.03-5.02-5.988-7.59-.605-.8-1.037-1.68-1.613-2.68-7.39 4.43-14.65 8.8-21.93 13.16z"/>
       <path fill-rule="evenodd" d="M248.84 169.78c-7.025 4.482-13.992 8.907-20.873 13.302-1.526-2.026-2.793-4.053-4.405-5.794-4.866-5.366-11.056-6.765-17.822-4.795-9.76 2.854-9.645 14.3-4.693 19.067 2.707 2.598 5.96 4.282 9.33 5.823 6.62 2.997 13.358 5.795 19.893 8.906 6.507 3.11 12.553 6.93 17.476 12.3 5.27 5.74 7.946 12.56 8.724 20.21.662 6.65.172 13.21-2.42 19.46-4.03 9.7-11.4 16.1-21.246 19.38-17.563 5.85-34.78 4.88-51.133-4.06-7.91-4.34-13.81-10.76-18.1-18.67-.14-.26-.26-.52-.37-.77-.03-.09-.03-.2-.03-.46 7.2-4.14 14.48-8.31 21.77-12.5 1.61 2.14 3.11 4.25 4.72 6.22 8.07 9.76 20.3 11.59 30.06 8.7 3.54-1.06 6.54-3 8.44-6.25 2.82-4.86 1.82-11.31-2.73-14.85-2.96-2.31-6.39-4.2-9.81-5.83-6.56-3.14-13.33-5.82-19.89-8.96-5.9-2.83-11.28-6.48-15.69-11.39-5.84-6.51-8.43-14.22-8.84-22.81-.43-9.25 1.82-17.64 7.92-24.78 5.01-5.85 11.4-9.51 18.86-11.39 9.15-2.31 18.34-2.23 27.44.34 10.14 2.85 18.57 9.96 23.47 19.55zM68.063 256.556c7.284-4.367 14.54-8.734 21.938-13.16.58.972 1.04 1.885 1.62 2.685 1.96 2.57 3.72 5.34 5.99 7.6 4.84 4.83 14.11 3.97 17.97 1.72 3.54-2.05 4.93-5.45 5.53-9.22.29-1.82.41-3.68.41-5.53.03-29.57.03-59.17.03-88.74 0-2.11 0-2.11 2.07-2.11 7.83 0 15.64.03 23.47-.02 1.24 0 1.64.28 1.64 1.57-.02 29.54-.02 59.06-.02 88.6 0 6.59-.66 13.1-3.08 19.3-3.74 9.59-10.51 16.19-20.38 19.33-12.43 3.94-24.84 3.77-36.94-1.46-9.24-3.99-15.63-10.96-20.01-19.84-.08-.17-.11-.34-.2-.68z" clip-rule="evenodd"/>
      </g>
      <path id="jo-ox" d="M275.932 149.03c7.774 0 12.12 4.395 12.12 10.874 0 6.48-4.375 10.876-12.12 10.876-7.773 0-12.322-4.396-12.322-10.876-.03-6.48 4.55-10.875 12.322-10.875zm0 15.384c4.29 0 6.737-1.712 6.737-4.538 0-2.797-2.48-4.54-6.74-4.54-4.29 0-6.97 1.714-6.97 4.54s2.67 4.538 6.96 4.538zm.202 13.53l11.46-5.965v6.9l-3.86 1.57c-1.094.51-2.39 1-3.915 1.65v.14c1.52.51 2.82 1 3.91 1.42l3.86 1.37v6.62l-11.75-5.97-11.84 6.34v-6.91l4.2-1.89c1.24-.57 2.47-1.08 3.91-1.65v-.14c-1.44-.52-2.68-1-3.92-1.51l-4.21-1.71v-6.62l12.12 6.33zm11.487 17.04v15.244h-5.21v-9.077h-4.52v7.77h-5.21v-7.76h-8.63v-6.19h23.58zm-11.68 17.926c7.78 0 12.12 4.4 12.12 10.88s-4.37 10.878-12.12 10.878c-7.77 0-12.32-4.396-12.32-10.875 0-6.48 4.55-10.876 12.33-10.876zm0 15.39c4.29 0 6.74-1.71 6.74-4.54 0-2.793-2.47-4.54-6.73-4.54-4.29 0-6.96 1.717-6.96 4.54s2.68 4.54 6.97 4.54zm-11.89 23.09l7.92-4.02V245h-7.91v-6.2h23.58v8.85c0 5.024-1.72 9.363-7.63 9.363-3.37 0-5.58-1.513-6.82-3.768l-9.15 5.08v-6.935zm12.84-6.39v2.226c0 2.457 1.1 3.74 3.11 3.74 2.02 0 2.68-1.283 2.68-3.74V245h-5.78zm10.74 16.47v6.908c0 7.107-3.34 12.017-11.69 12.017s-11.89-4.88-11.89-11.645v-7.28h23.58zm-18.6 6.537c0 3.368 1.39 6.05 6.88 6.05 5.5 0 6.68-2.654 6.68-6.05v-.372h-13.56v.373z"/>
    </svg>
    <a href="?interval=5">5sec interval (default)</a> | <a href="?interval=10">10sec interval</a>
  </div>

  <script src="https://rawgit.com/kriskowal/q/v1/q.js"></script>
  <script>
    var jsText = document.getElementById("jo-js");
    var oxText = document.getElementById("jo-ox");
    var bg = document.getElementById("bg");
    var members = document.getElementById("members");
    var interval =  (window.location.search.substr(window.location.search.indexOf('interval='+9)) || 5) * 1000;

    function removeClass(selector, classname) {
      var matching = document.querySelectorAll(selector);
      var re = new RegExp(classname, 'g');
      for(var i=0; i<matching.length; i++){
        var currentClassName = matching[i].getAttribute("class") || "";
        matching[i].setAttribute("class", currentClassName.replace(re, ""));
      }
    }
    function addClass(selector, classname) {
      var matching = document.querySelectorAll(selector);
      for(var i=0; i<matching.length; i++){
        var currentClassName = matching[i].getAttribute("class") || "";
        matching[i].setAttribute("class", currentClassName + " " + classname);
      }
    }

    function clear(){
      addClass('.visible', 'hidden');
      removeClass('.visible', 'visible');
      removeClass('.outline,.classic,#bg,.slidein', '(outline|classic|slidein|slideup)');
    }

    function classicLogo() {
      bg.setAttribute("class", "slideup");
      oxText.setAttribute("class", "classic");
      jsText.setAttribute("class", "classic");
    }

    function horseWithTimeout() {
      return Q.fcall(function() {
          document.getElementById("jo-standard-horse").setAttribute("class", "slidein");
        })
        .delay(interval / 3)
        .then(function() {
          addClass('.jo-cbars', 'visible');
        })
        .then(function() {
          removeClass('.jo-wbars', '(spinclockwise|spinanticlockwise)');
        })
        .delay(interval / 3)
        .then(function() {
          removeClass('.jo-cbars', 'visible');

          var whitebars = document.querySelectorAll('.jo-wbars');
          whitebars[0].setAttribute("class", (whitebars[0].getAttribute("class") || "") + " spinclockwise");
          whitebars[1].setAttribute("class", (whitebars[1].getAttribute("class") || "") + " spinanticlockwise");
        })
        .delay(interval / 3);
    }

    function membersLogo() {
      members.setAttribute("class", "visible");
      oxText.setAttribute("class", "outline");
      jsText.setAttribute("class", "outline");
    }


    function doAnimate() {
      Q.delay(interval)
        .then(clear)
        .then(classicLogo)
        .delay(interval)
        .then(clear)
        .delay(interval)
        .then(horseWithTimeout)
        .then(clear)
        .delay(interval)
        .then(membersLogo)
        .delay(interval)
        .then(clear)
        .delay(interval)
        .done(doAnimate);
    }

    doAnimate();
  </script>

  <script>
    // Just a timer to check when animations happen
    var time = 0;
    setInterval(function() {
      document.getElementById("timer").innerText = ++time + " seconds";
    }, 1000);
  </script>
</body>
</html>